---
title: "Data Processing"
subtitle: "Workflow"
author: "Daniel Cusimano"
date: "08/15/2024"
output: html_document
---

# Data Processing in R Workflow

## Purpose and Design

This page is a short overview of the SlicerMorph data and a walkthrough of how it was prepared for detailed analysis in r. It illustrates the processes of importing data, merging it with demographic qualifiers, and organizing it into an array that can be read and manipulated with the `geomorph` package. 

This markdown file utilizes codechunks.
```{r, include=FALSE, cache=FALSE}
knitr::read_chunk('...Code/SLprocess.r')
```

Load needed packages

```{r, Loadpackages, message=FALSE, warning=FALSE}
library(rgl)
setupKnitr(autoprint = TRUE)
```

## Importing Data

The process for imported Slicer Data into a workable format in R was followed from the SlicerMorph/Tutorials page at `https://github.com/SlicerMorph/Tutorials/blob/main/GPA_3/parser_and_sample_R_analysis.md`. The instructions provided by this page were followed closely and adjusted if/when they did not provide the needed results. 

The primary file needed from the slicer export is the analysis.log file. This contains all of the objects generated by SlicerMorph's GPA Module. These objects are parsed by `parser()` and stored in the SM.log list as individual objects. The SlicerMorph Tutorial suggests using `parser2()` for this process but this did not work for my files (hence the use of `parser()`. 

```{r, loaddata}
```

## Merging Demographic data with Landmark data

The SlicerMorph GPA module worked well to identify Procrustes Distances and develop PCAs but was not able to show where the sample variation came from. To highlight the significance of these results I developed an Excel spreadsheet with data on each individual's Age, Sex, and Ancestry. This data then needed to be imported into r and merged with the SM.output landmark data. 

The following tables illustrate the first 6 rows of the merged data. The demographic information was stored as factors, the first to numeric variables after these (columns 5 and 6) came from the original SlicerMorph analysis and account for the Procrustes Distances and Centeroids. The rest of the data (masked from this table to save space) is the coordinate data. 

```{r, merge}
```

## Build array from Slicer data

To work with coordinate data in r, `geomorph` requires that the information be formatted into an array by using `arrayspecs`. 

```{r, BuildingArray}
```


```{r, Array}
```

To visualize the coordinate data (see below) I took the mean shape from the landmarks and plotted them to build a wire fram using `d1Links <- define.links(Mshape.Coords, ptsize = 7, links = NULL)`. This is the code needed to initiate the construction of a wireframe. This code is not saved in my `data_processing.r` script. If in the code script, the analysis will pause and wait for the construction of a new wireframe each time it is run. Instead I ran the code once and saved the resulting data as a spreadsheet `d1Links.csv`. This file can be found in the `Data` folder. 

:::{#fig layout-ncol=2}

   ![](Images/AntWire.png)
   
   ![](Images/LatWire.png)
   
   Wireframe from Coordinates
:::

## The next steps in this project can be found on the [`Analysis`](R_Analysis.qmd) page. 