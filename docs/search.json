[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "D. Cusimano Research Methods",
    "section": "",
    "text": "About\nThis site is exists to reflect the development of the methods being proposed for capturing Geometric Morphometric data by using 3D Photogrammetry and digital landmarking software. The navigation bar above links to the different steps in this project."
  },
  {
    "objectID": "Morph.html",
    "href": "Morph.html",
    "title": "Morphometrics",
    "section": "",
    "text": "3D Slicer\n\n\n- SlicerIGT\n- SlicerMorph\nThis workflow is in progress. The following walkthrough provides instructions on how to import, align, fix landmarks to, and analyze data from the models created in Reality Capture. Before any of this is achieved, it is important to load the correct modules into 3D Slicer.\n\n\n\n\nOn the main task ribbon, find the icon for Extensions Manager\n\nBlue icon with a puzzlepiece and capital ‘E’\nThis will pull open a window with a Manage Extensions tab and a Install Extensions tab\n\nNavigate to the Install Extensions window\n\nYou can either scroll through the available extensions to find the ones needed or use the search window in the top right corner\n\nOnce the extensions are installed, navigate back to the Welcome to Slicer screen Fig.1\n\n\n\n\nFigure 1: Welcome to Slicer\n\n\n\n\n\nThis step specifies the process of loading data for a single model with no associated landmark data. For more details on how to import multiple files for alignment and landmark configuration see the Alignment and ALPACA sections below\n\nTo import the Reality Capture models, click on the Add Data button\n\nThis button can be found twice on the welcome screen or under the File dropdown menu\n\nSelect Choose File(s) to Add\n\nSelect both the Model file and the Texture file Fig.2\nGive the software a moment to load your data and you should see two images loaded Fig.2\nTo keep track of what files are loaded in Slicer, navigate to the Data window from the Modules dropdown menu. See Below\n\nWhile not important for this step, you can check to see that your Texture file works with the model by opening the Texture Model modules\n\nThis can be done by either scrolling through the Modules dropdown menu to the Surface Models tab and then to the Texture Model module or by clicking on the magnifying class in the task ribbon and searching for Texture Model\nIn either case you will open a window with three boxes for data and parameters.\n\nIn the Model box, make sure your Reality Capture OBJ file is selected\nIn the Texture box, make sure your resized PNG texture file is selected\nThe last box provides the option to save color information as point data. My practice is to set this as RGB Vector\n\nClick on Apply to see your textured model Fig.3\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 2: Loading Data\n\n\n\n\n\nFigure 3: Textured Model\n\n\n\n\n\nWhen working with multiple models it becomes important to make sure that each is in the same alignment within a 3D cartesian plane. To accomplish this we make use of the FastModelAlign module available through slicer morph.\nThis step requires at least two models. We recommend establishing one model as the template for this step as well as for the landmark configuration process in future steps.\n\nLoad in an additional model.\n\nfollow the steps from above and check that you have two models loaded in the Data window\n\nFind the SlicerMorph tab under the Modules dropdown menu\n\nSelect SlicerMorph Utilities\n\nSelect FastModelAlign\n\n\nThe options in this model are somewhat misleading\n\nUnder Source Model select the model that you are trying to align to a template\nUnder Target Model select the model that you will use as a template\nClick on the box that says Skip Scaling\nFor the Output registered model select the same model as you used for Source Model\n\nClick on the Test pointcloud subsampling button\n\nGive it a moment to generate a point cloud. Typically between 5000-5500 points\n\nClick on Run rigid registration\n\nOnce the rigid registration is completed both models will be overlapping. To see the differences between the two models you can choose to have one textured and the other not or you can navigate back to the Data window and change the colors of either model.\n\n\n\nFigure 4: Aligned Models\n\n\n\nWith this complete, click on the Save button\n\nThis will open a Save Scene window with multiple files selected\nMake sure that only the file you need to save is selected, in this case the model that was being aligned.\n\n\n\n\n\nThe process of placing landmarks in 3D Slicer is not overly complicated as long as the user has the following:\n\nA list of desired landmarks\nDefinitions of each landmark with instructions on how to find it this sometimes differs if taking the landmark manually or digitally\nA clear method of organizing landmarks so that each landmarking sequence is the same for every specimen\nA clear way of lablling landmarks and format for saving landmark files\n\n\nThe module used for configuring Geometric Morphometric landmarks is called Markups and can be found either in the modules dropdown menu or on the primary task ribbon.\n\nIn either case, the module wile be associated with an icon that looks like three red asteristks arranged in a triangle. \n\nOnce in the Markups module, select the Point List button to establish your coordinate file.\n\nSlicer will give this list a priliminary name which should be changed to suit suit the researchers needs\n\nI use the prefix LM followed by an underscore* and the specimen number\nEx. LM_####\n*The underscore becomes important latter when using this landmark data in R. This is because R does not like spaces in file names.\n\n\nAfter naming the Point List, open the Display and Control Points menus below.\n\nWhen hovering the cursor over the model, a potential point will display with an icon and specimen/point number\nFor ease of use, the size of both or either of these features can be changed in the display menu\nSet this to your preference (often a touch smaller than the default)\nIt is good to follow what point number you are on. For each specimen assessed through this workflow, the point numbers should match. For example, if point one on specimen one is Left Alare, point one on all specimens should be Left Alare. Do Not Rearrange the Points for Different Specimens\n\n\n\n\n\nFigure 5: Placing Landmarks\n\n\n\n\n\nFigure 6: Landmark Set\n\n\n\nA couple of notes on using Markups\n\nTo place a Control Point, make sure the Place control point button is selected \nWhile placing control points, left clicking anywhere will place a point. If you need to rotate the model, right click to switch back to the cursor. Then click the Place control point button  above to switch back.\nIf a control point is placed in the wrong spot (inevitable in this process) it is better to move it than to delete it.\n\nIf it is in the wrong order (i.e. you placed the right before the left) you can either move multiple points or rename the points. Either case is better than deleting the control point.\n\nWhen developing your Point List it is good practice to name each point in the corresponding description box\n\nThis will become even more useful later\n\n\nCraniometric Points in Slicer\n\nPlacing points in Slicer has it’s advantages and disadvantages\nAdvantages\n\nThe R, A, S (Right, Anterior, Superior) fields can allow one to find the most lateral, anterior, superior, and etcetera surfaces on the model.\nIf your scale was set appropriately in Reality Capture, finding points such as Opisthocranion become simple by using the line tool to measure the distance from Glabella to the farthest surface on the posterior aspect of the skull\nThe model is easily rotated to establish points such as Basion on the inferior aspect of the skull\nIt is easy to visually keep track of data along the way by keeping each control point viewable\n\nDisadvantages\n\nThere is no question that some detail is lost\n\nFaint suture lines, for example, that may be visible with appropriate light and magnification are occassionally lost in the digital format\nFeatures that are sometimes easier to feel (i.e., temporal lines) are more difficult to discern\nTo clarify how each of the landmarks used in this study were obtained, a Data Dictionary with descriptive text and images will be generated soon.\n\n\n\nSaving Data\n\nOnce all points have been established, click on the Save button in the primary task ribbon\nBe sure to only select the file that you intended (Slicer will auto-select multiple files) and establish the proper directory for it\n\nSince we modified the cloned landmark set, Slicer attempts to save this file with the original template data\n\nWhen you click on Save from this window, Slicer will alert you to warnings which occured while saving. Ignore this and save away.\n\n\n\n\n\nOnce a primary Point List is established with one model, SlicerMorph provides a wonderful shortcut for establishing the same point list for other specimens. This is done through the ALPACA module.\n\nFind SlicerMorph from the modules dropdown menu.\n\nHover over Geometric Morphometrics\n\nSelect ALPACA\n\n\nThere are a few data fields to fill in\n\nUnder Source Model select the model you are using for a template\n\nThis will likely be the same template model used for Alignment\nBe sure that you have the necessary landmark data associated with this model\n\nUnder Source Landmark Set select the .fcsv file (Point List) you saved with the coordinate data\nUnder Target Model select the model file that does not have associated coordinate data\nMake sure that Scaling and Projection are not chaecked\nLeave the Target Landmark Set (Optional) field blank\n\nSelect Run subsampling\n\n*Be aware that if you have the texture data loaded for any of the models when running APACA, the subsampling process will not work. Make sure you only have Model and Landmark data loaded\nYou will generate a pointcloud (similar to the alignment process) that sits somewhere between 5000-5500 points\n\nSelect Run ALPACA\n\nWhen ALPACA is complete you will be provided with a clone of the landmark data that can be modified over your target model.\nThere are a couple of different files generated after running ALPACA. You can review these when navigating back to the Data module or, better for our purposes, back to the Markups module\nIn Markups you should see 3 Point Lists\n\nThe original template file\nThe cloned template file\nThe ALPACA extimate file\n\nDespite the ALPACA effort, these files can never be perfectly placed on the new model. Thus, the next step is to manually adjust each control point to best match the landmark definition.\nThe main benefit of running ALPACA then becomes the transfer of the point list and the increased efficiency gained by adjusting points rather than placing new points.\n__Be sure that you are adjusting the correct point list. I work with the Source_Landmarks_clone file\n\n\n\n\n\nFigure 7: ALPACA Overlay\n\n\n\nRename the Point List you are adjusting\n\nMatch the file format from above (i.e., LM_####)\n\nLoad in the Texture data\n\nFollow the instructions listed under Importing Data above\n\nAdjust Landmarks and save as described in the Landmark Configuration section above.\n\n\n\n\n\nThus far, each Model, Texture, and Landmark file has been saved in its own folder.\n\nEx. Dcusimano -> Skull ###, Skull ###, Skull ###\nWith the incoming Landmark Data, I found it conveneient to have an additional folder for only this information\nEx. Dcusimano -> Coordinate Data\nThis will help tremendously when running our analyses in the next step\n\n\n\n\n\nThe last step for a typical Geometric Morphometric analysis in Slicer is to run the Generalized Procrustes Analysis (GPA). With a decent sample of Landmark data, this step is super simple.\n\nNavigate to the GPA module under the SlicerMorph tab in the modules dropdown menu SlicerMorph->Geometric Morphometrics->GPA\nClick on Select Landmark Files -If you consolidated your files into one folder, you can simply select all -It is possible to select the individual files from multiple folders, but far more tedious -Click the ... button next to the Select Output Directory field -I keep the output directory as the Coordinate Data folder -I choose to select the Use Boas coordinates for GPA button\nSelect Execute GPA + PCA\n\nWhen the analysis is complete, Slicer will provide you a few windows to explore your data\nOne option is to Navigate to the Explore Data/Results window from the GPA task ribbon\nAs a general assessment, I like to use the Plot LM Variance tool to see where most of the landmark variation is coming from\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 8: Generalized Procrustes Analysis\n\n\n\nAnalysis files\n\nWhile fun to explore the results in Slicer, the most important product of the GPA is the output files it provides.\n\nThese are viewable in the folder that was selected for Output Directory or by selecting View output files below the Execute GPA + PCA button\n\n\n\n\n\n\nFigure 9: Output Files"
  },
  {
    "objectID": "Photogrammetry.html",
    "href": "Photogrammetry.html",
    "title": "Photogrammetry",
    "section": "",
    "text": "This workflow walks through the process of digitizing skeletal materials via photogrammetry for geometric morphometric analysis in 3D Slicer.\n\n\nFoldio 360 Phone App\nAdobe Lightroom\nReality Capture\n3D Slicer\n-Extensions: Slicer IGT & SlicerMorph\n\n\n\nFoldio smart turntable and lightbox\nCanon EOS 6D DSLR camera\n\n\n\n\n\n\nTurn on the foldio equipment and camera to initialize Bluetooth link between turntable and camera\nEnsure that the light box is turned on and the fluorescent room lights are turned off\nOpen foldio app on smartphone\n\nSelect DSLR 360 from the device information screen\nClick on Select Device at bottom of screen\n\nFoldio 360 should appear as an option\n\nOpen Select Camera Brand menu and select Canon (either one)\nUnder settings select IR remote delay and set to 2 seconds\nOn main screen, set number of shots to 36 (you will see the default of 24 on the display. Click this once to change to 36)\n\n\n\nSet the camera to Av\n\nSet the White Balance to Color Temperature (hit the Q menu button and scroll through options until you see white balance)\nSet camera to Manual Focus\n\nPlace specimen in the center of the turntable\n\nUse a stand/ring mold\nIf this is a skull, set the beginning position as close to Frankfurt horizontal as possible.\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 1: Lightbox Arrangement\n\n\n\nFocus camera on specimen. For best precision, use the magnifying glass button on camera to zoom over focused region.\nOnce all settings are in place, press the orange button on the foldio app to begin shooting.\n\nDo not close the app or return to home screen on phone. This will stop the process.\n\nWait until all 36 photos have been taken. Then rotate antero-superiorly (rotate along sagittal plane)\n\nTo capture all need angles you will need to reposition the skull about 6 times, rotating it approximately 30 degrees in the sagittal plane each time. Your last set of photos should be shot with the frontal bone positioned in the ring mold.\n\nRemove the memory card from the camera and load into Adobe Lightroom on computer\n\n\n\n\n\n\n\nTo view photos, click on import and choose the USB drive\n\nFind DCIM under 100 Canon\nMake sure that only the photos that you want imported are selected\nClick Import\n\nOnce photos are imported, click on Develop in top right corner\n\nThis will open full view of first photo in the list\n\nClick on the eyedropper icon on the right side of the screen and then click on the photo\n\nFrom this window you can also adjust the Texture and Temp of the file. Increase a bit for more detail but not so much that it begins to highlight details other than the crania (e.g., aspects of the turntable or specimen stand)\n\nWhen settings are as you want them, click on Copy in the bottom left corner. Click Ok on the menu that pops up.\n\nThen hold control and press ‘a’ to select the entire library.\nClick Sync in the bottom right corner to apply to all\n\nAnother pop-up window will appear. Click Ok to sync\n\nYou can switch back to library view from the menu in the top right corner to see if Lightroom is applying your changes to all photos.\n\nWhen complete, hit Export in bottom left corner and choose a folder to send the images.\n\n\n\n\n\nOpen Reality Capture\nUnder Workflow in the ribbon on top should have an icon that says Folder, click on this and select the folder that your exported photos are in.\nCheck to see that the images loaded by observing the image count in the window on the left of the screen\nClick on the Alignment tab in the ribbon and find/click on the Align Images button\n\nWait while the program creates your model\n\nThe resulting image can vary in its presentation. In any case, it will look like a pixelated model of your specimen. If it looks like your specimen in multiple views (i.e., the images didn’t create one cohesive model) you will need to add more photos or begin the process again. If the images come together to create what looks like a good rendition of the specimen you can move on.\n\n\nTo orient the model, click on the Tools button in the SCENE 3D ribbon. At the very left of the ribbon menu there are two buttons for setting the Reconstruction Region and the Ground Plane. Begin by clicking Set Ground Plane\n\nYou will observe three colored rings and three colored bars appear within your model.\nClicking on any of the colored rings will allow you to rotate your model. Do this until it is in proper anatomical position (for crania, position in Frankfurt Horizontal).\nOnce in the correct position, click on the vertical colored bar to drag the model up to place on the ground plane.\n\n\n\n\n\n\n\nIf importing this into 3D Slicer (which we will for this purpose), you will want to orient the image backwords (i.e., when viewed from the front, you are looking at the back). This can be checked by opening the View menu under the Scene 3D tab and finding the View Camera box. The default setting is on Perspective which will be used for orienting the specimens. Click on this to see the dropdown menu and select Front. Adjust the orientation until this view shows the back of the specimen.\n\nClick on the Set Reconstruction Region tab in the top left menu\n\nA bounding box will appear around your model. Make sure that this box encompasses your entire model (nothing outside the box)\n\nSetting Scale\n\nOnce the model is properly oriented, move to establishing the correct scale.\nUnder the Tools tab in SCENE 3D, click on the Control Points tab\nA menu will appear on the left of the screen\nClick on the button that says Control Points in this menu and then select Create\n\nIt will generate an unassigned point (point 0)\n\nA small pop-up window will appear in the upper right corner of your screen suggesting that control points be assigned in 2D mode. Heed this advice.\n\nNear where this pop-up appeared (top right of model viewer screen) is a small white box that reads 3Ds. Click and hold this button to access the dropdown menu.\nOpen the 2Ds library\nImportant. You will need to choose at least 2 different photos to set the control points. If you pressed Test Connection on the foldio app when taking photos, you will likely have at least two copies of the first image. Do not use the duplicate shot when setting control points.\nClick on the first image you want to use and open the drop down menu again.\n\nClick on 2D, to view this image\nClick on the point 0 button that generated earlier. You can now place this point on your image.\nAfter this point is placed, generate another unassigned point by clicking create. This will give you ‘point 1’\nSelect this unassigned point and place it on the image.\n\nThere is no protocol yet for what points to use. I am using the nasal height as my metric for setting scale. Thus, I am setting point 0 at Nasion, and point 1 at the tip of the anterior nasal spine\n\nReturn to the 2Ds library and click on the second image. Being sure to select the correct points (first point 0, then point 1), assign the points to the corresponding positions on this image.\n\nTo set your scale, you will first need to know the distance between these two points. Collect this distance manually on the physical specimen with sliding calipers.\nIn Reality Capture, under Tools in the SCENE 3D menu, select Define Distance\n\nClick on point 0 in one of your 2D images and drag to point 1\nA box will appear in the menu on the left of your screen (Selected Constraint(s))\nReality Capture will provide you with a Defined Distance that does not look accurate. Delete the number provided for you and type in the measurement that you collected manually.\nNote that Reality Capture insists on the scale being in meters. If your measurement is in Millimeters (should be), make sure to properly convert the measurement.\n\n\nOnce your distance is defined, go back to the Alignment Menu from the top ribbon.\n\nClick on Update\nIf everything went right, this will quickly update the scale for your model\n\n\nFinishing the Model\n\nTo finish the model making process, return to the Mesh Model menu\nClick on the Normal Detail button.\nThis will take a minute\n\nWhen complete, a matte white model will be provided\nLook over the model to ensure that all aspects of your specimen are visible\nIf the model includes foreign objects (e.g., parts of the stand), use the Lasso tool provided in the Tools menu under the Scene 3D ribbon.Use this tool to highlight the unwanted objects and click on Filter Selection to remove.\n\nWith the model completed, we want to compress the file for more efficient computing down the line. This step may or may not be necessary depending on the computing power of the processor being used. Thus, it is a part of our workflow but possibly unnecessary for others. To accomplish this, click on the Simplify button in the same Tools menu. We simplify the Target Triangle Count to 200,000 (Observe the Simplify Tool menu that appears on the left side of the screen).\n\nClick Simplify at the bottom of the menu\n\n\nTexturize and Export\n\nWith the model completed and simplified, we want to apply the appropriate texture. This can be done by selecting Texture under the Mesh Model menu.\nWith each step completed we can now export the model to be analyzed in 3D Slicer\n\nWhile in the same menu, select Dense Mesh Model from the Export box\nChoose the Folder to save it in (We create a new folder for each specimen) Press Ok when the Export Model window pops up\n\n\nResize texture file\n\nThe texture file that was exported with your model will look something like Mesh_Model_1_u1_v1_diffuse and will be in a .PNG format\nDepending on your computer, this file may be fine as is but for our purpose it became important to resize the image for quicker processing in 3D Slicer\nTo resize the image, open it from your file, right click over the image and find the Resize image option.\nclick on the Percentage option and change to 50%\nIdeally the image size is at 4096x4096\nIt is also our practice to change the file type to JPG\nSave this image under a recognizable name and you’re good to go"
  },
  {
    "objectID": "R_Analysis.html",
    "href": "R_Analysis.html",
    "title": "R_Analysis",
    "section": "",
    "text": "R_Analysis Workflow\nI’m saving this string of code here for the time being d1Links <- define.links(Mshape.Coords, ptsize = 7, links = NULL)\nThis markdown file utilizes codechunks.\nLoad needed packages\n\nrequire(geomorph) #for GM analysis\nrequire(SlicerMorphR) #for importing Slicer data\nrequire(plyr) #for wireframe specs\nrequire(dplyr) #for data processing/cleaning\nrequire(tidyr) #for data processing/cleaning\nrequire(skimr) #for nice visualization of data \nrequire(knitr) #for qmd building\nrequire(gapminder) #for plot aesthetics\n\nLoad needed data\n\nSM.log.file = \"Data/Analysis_8-15/analysis.log\"\nSM.log <- parser(SM.log.file)\n\nWarning in readLines(file): incomplete final line found on\n'Data/Analysis_8-15/analysis.log'\n\nhead(SM.log)\n\n$input.path\n[1] \"C:/Users/danny/Documents/git/Research_Methods/Data/Coordinates\"\n\n$output.path\n[1] \"C:/Users/danny/Documents/git/Research_Methods/Data/Analysis_8-15\"\n\n$files\n [1] \"LM_1575.fcsv\" \"LM_1601.fcsv\" \"LM_2270.fcsv\" \"LM_2274.fcsv\" \"LM_2294.fcsv\"\n [6] \"LM_2303.fcsv\" \"LM_2317.fcsv\" \"LM_2343.fcsv\" \"LM_2368.fcsv\" \"LM_2380.fcsv\"\n[11] \"LM_2458.fcsv\" \"LM_2463.fcsv\" \"LM_2467.fcsv\" \"LM_2487.fcsv\" \"LM_2508.fcsv\"\n\n$format\n[1] \".fcsv\"\n\n$no.LM\n[1] 55\n\n$skipped\n[1] FALSE\n\nSM.output <- read.csv(file=paste(SM.log$output.path,\nSM.log$OutputData,\nsep = \"/\"))\n\nSlicerMorph.PCs <- read.table(file = paste(SM.log$output.path,\nSM.log$pcScores,\nsep=\"/\"),\nsep=\",\", header = TRUE, row.names=1)\n\nPD <- SM.output[,2]\nif (!SM.log$skipped) {\nno.LM <- SM.log$no.LM\n} else {\nno.LM <- SM.log$no.LM - length(SM.log$skipped.LM)\n}\n\ndem<-read.csv(paste(\"Data/dem.csv\", sep=\"\"))\ndem\n\n        ID    Sex    Age   Ancestry\n1  LM_1575   Male  60-70        Mix\n2  LM_1601 Female  70-80  Caucasian\n3  LM_2270   Male  70-80        Mix\n4  LM_2274 Female  80-90        Mix\n5  LM_2294 Female  80-90     Korean\n6  LM_2303   Male  70-80  Caucasian\n7  LM_2317   Male  60-70  Caucasian\n8  LM_2343 Female 90-100   Japanese\n9  LM_2463 Female  70-80 Portuguese\n10 LM_2467 Female  70-80  Caucasian\n11 LM_2380   Male 90-100  Caucasian\n12 LM_2368 Female  50-60        Mix\n13 LM_2458   Male  80-90  Caucasian\n14 LM_2487   Male  80-90  Caucasian\n15 LM_2508   Male  70-80  Caucasian\n\n\nMerge Demographic data with Landmark data\n\ndat<- merge(SM.output, dem, by= \"ID\")\ndat$ID <- as.factor(dat$ID)\ndat$Sex <- as.factor(dat$Sex)\ndat$Age <- as.factor(dat$Age)\ndat$Ancestry <- as.factor(dat$Ancestry)\n\nd1 <- dat %>% relocate(where(is.factor), .before = proc_dist)\nskim(d1[1:6], )\n\n\nData summary\n\n\nName\nd1[1:6]\n\n\nNumber of rows\n15\n\n\nNumber of columns\n6\n\n\n_______________________\n\n\n\nColumn type frequency:\n\n\n\nfactor\n4\n\n\nnumeric\n2\n\n\n________________________\n\n\n\nGroup variables\nNone\n\n\n\nVariable type: factor\n\n\n\n\n\n\n\n\n\n\n\nskim_variable\nn_missing\ncomplete_rate\nordered\nn_unique\ntop_counts\n\n\n\n\nID\n0\n1\nFALSE\n15\nLM_: 1, LM_: 1, LM_: 1, LM_: 1\n\n\nSex\n0\n1\nFALSE\n2\nMal: 8, Fem: 7\n\n\nAge\n0\n1\nFALSE\n5\n70-: 6, 80-: 4, 60-: 2, 90-: 2\n\n\nAncestry\n0\n1\nFALSE\n5\nCau: 8, Mix: 4, Jap: 1, Kor: 1\n\n\n\nVariable type: numeric\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nskim_variable\nn_missing\ncomplete_rate\nmean\nsd\np0\np25\np50\np75\np100\nhist\n\n\n\n\nproc_dist\n0\n1\n0.07\n0.01\n0.06\n0.07\n0.07\n0.07\n0.11\n▇▂▁▁▁\n\n\ncenteroid\n0\n1\n0.54\n0.01\n0.51\n0.53\n0.54\n0.54\n0.56\n▃▅▇▆▂\n\n\n\n\n\nBuild array from Slicer data\n\nCoords <- arrayspecs(SM.output[,-c(1:3)],\np=no.LM,\nk=3)\n\ndimnames(Coords) <- list(1:no.LM,\nc(\"x\",\"y\",\"z\"),\nSM.log$ID)\n\nRun preliminary analyses\n\nd1array.gpa <- gpagen(Coords, print.progress=FALSE)\n\nsummary(d1array.gpa)\n\n\nCall:\ngpagen(A = Coords, print.progress = FALSE) \n\n\n\nGeneralized Procrustes Analysis\nwith Partial Procrustes Superimposition\n\n55 fixed landmarks\n0 semilandmarks (sliders)\n3-dimensional landmarks\n2 GPA iterations to converge\n\n\nConsensus (mean) Configuration\n\n              X            Y            Z\n1   0.088944373  0.017112548 -0.041115700\n2   0.086713372 -0.027345317 -0.040021395\n3  -0.162443890  0.117405845 -0.018763507\n4  -0.174582983 -0.097198168 -0.022417884\n5  -0.072835774  0.005410136 -0.069411402\n6  -0.061195686  0.003623447  0.194245899\n7   0.072841404  0.014012998  0.026215460\n8   0.070317703 -0.022981056  0.025318686\n9   0.055937474  0.090097271  0.019004102\n10  0.042264419 -0.095650389  0.016701833\n11  0.041823214  0.056701035 -0.079885979\n12  0.031724630 -0.059210552 -0.082664696\n13 -0.088723351  0.137570447  0.047611249\n14 -0.118946520 -0.126509256  0.050197105\n15 -0.106340677  0.038772004 -0.080774211\n16 -0.111675376 -0.023241438 -0.080421196\n17  0.060162857  0.088468310  0.032156854\n18  0.045968220 -0.095906425  0.030038061\n19  0.056787889  0.093792044  0.037006096\n20  0.041374212 -0.100759624  0.034888199\n21  0.054626471  0.084012697  0.068863984\n22  0.040931330 -0.091916980  0.066414210\n23  0.090848557 -0.005977439  0.061501267\n24  0.034752009  0.102310323 -0.008181600\n25  0.020402348 -0.106164678 -0.009282208\n26 -0.242708463  0.017510623  0.074039167\n27  0.077062242  0.049744606 -0.013061859\n28  0.070255052 -0.058779766 -0.013404260\n29  0.078631253  0.055598228  0.055444973\n30  0.067061074 -0.065688694  0.054134265\n31 -0.085089793  0.110034274 -0.081992605\n32 -0.100780129 -0.098243674 -0.082436290\n33 -0.008952205  0.110512561  0.098894026\n34 -0.029123494 -0.111124422  0.104723166\n35  0.092003602  0.004661012 -0.055469829\n36  0.090565965 -0.015323603 -0.055366853\n37  0.088115891 -0.005829385  0.044062491\n38 -0.247452919  0.021116598  0.002338568\n39 -0.141391551  0.010524882 -0.083613989\n40 -0.070052672  0.110397031 -0.028715450\n41 -0.085465394 -0.102537393 -0.029127669\n42  0.105687539 -0.005653951 -0.086204524\n43 -0.015247706  0.105121853  0.123212577\n44 -0.028721660 -0.106831839  0.118379151\n45  0.100453940 -0.005586806 -0.065498736\n46 -0.010619253  0.121897023 -0.023504552\n47 -0.031223312 -0.119754233 -0.024495686\n48  0.060985556  0.079391502 -0.048708201\n49  0.048934846 -0.086426001 -0.050274464\n50  0.076454649  0.043958386 -0.010324984\n51  0.070609291 -0.053127943 -0.010492446\n52  0.007195879  0.113277545 -0.030760860\n53 -0.010007651 -0.113315049 -0.031915608\n54  0.024282284  0.107561862 -0.013055180\n55  0.008860913 -0.109513011 -0.014027568\n\nMshape.Coords<-mshape(Coords)\nhead(Mshape.Coords)\n\n              x           y            z\n1  0.0142205765 -0.04501951 -0.024759076\n2 -0.0096120764 -0.04619559 -0.024655985\n3  0.0541053831  0.09325809 -0.003028978\n4 -0.0608354106  0.08862981 -0.007258012\n5 -0.0003492661  0.04146364 -0.034552159\n6 -0.0031006576  0.02596099  0.105905142\n\nd1.pca<-gm.prcomp(d1array.gpa$coords)\nplot(d1.pca)\n\n\n\n SlicerMorph.MS <- read.table(file = paste(SM.log$output.path,\n                                            SM.log$MeanShape,\n                                            sep=\"/\"),\n                               sep=\",\", header = TRUE, row.names=1)\n                               \n                               par(mfrow= c(2,2))\nplot(d1.pca, main = \"PCA\",\ncol=dat$Ancestry,\npch=16)\nlegend(\"topright\", pch = 20, col=unique(dat$Ancestry), legend = unique(dat$Ancestry))\n\n\n\nplot(d1.pca, main = \"PCA\",\n    axis1=1, axis2=3,\n    col=dat$Ancestry,\n    pch=16\n)\nlegend(\"topright\", pch = 20, col=unique(dat$Ancestry), legend = unique(dat$Ancestry))\n\nplot(d1.pca, main = \"PCA\",\n    axis1=2, axis2=3,\n    col=dat$Ancestry,\n    pch=16\n)\nlegend(\"topright\", pch = 20, col=unique(dat$Ancestry), legend = unique(dat$Ancestry))\n\nplot(d1.pca, main = \"PCA\",\n    axis1=3, axis2=4,\n    col=dat$Ancestry,\n    pch=16\n)\nlegend(\"topright\", pch = 20, col=unique(dat$Ancestry), legend = unique(dat$Ancestry))\n\n\n\n\n\ngdf <- geomorph.data.frame(PD,\nAncestry = dat$Ancestry,\nSex = dat$Sex,\nCsize = dat$centeroid)\nattributes(gdf)\n\n$names\n[1] \"\"         \"Ancestry\" \"Sex\"      \"Csize\"   \n\n$class\n[1] \"geomorph.data.frame\"\n\nlm.fit <- procD.lm(Coords~Ancestry*Sex, data=gdf)\n\n\nWarning: Because variables in the linear model are redundant,\nthe linear model design has been truncated (via QR decomposition).\nOriginal X columns: 10\nFinal X columns (rank): 7\nCheck coefficients or degrees of freedom in ANOVA to see changes.\n\nsummary(lm.fit)\n\n\nAnalysis of Variance, using Residual Randomization\nPermutation procedure: Randomization of null model residuals \nNumber of permutations: 1000 \nEstimation method: Ordinary Least Squares \nSums of Squares and Cross-products: Type I \nEffect sizes (Z) based on F distributions\n\n             Df        SS        MS     Rsq      F        Z Pr(>F)  \nAncestry      4 0.0090834 0.0022709 0.37550 1.5073  1.63054  0.056 .\nSex           1 0.0019193 0.0019193 0.07934 1.2739  0.69194  0.234  \nAncestry:Sex  1 0.0011348 0.0011348 0.04691 0.7532 -0.46291  0.675  \nResiduals     8 0.0120528 0.0015066 0.49825                         \nTotal        14 0.0241903                                           \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nCall: procD.lm(f1 = Coords ~ Ancestry * Sex, data = gdf)\n\nanova(procD.lm(Coords~Csize + Ancestry*Sex, data=gdf))\n\n\nWarning: Because variables in the linear model are redundant,\nthe linear model design has been truncated (via QR decomposition).\nOriginal X columns: 11\nFinal X columns (rank): 8\nCheck coefficients or degrees of freedom in ANOVA to see changes.\n\n\n\nAnalysis of Variance, using Residual Randomization\nPermutation procedure: Randomization of null model residuals \nNumber of permutations: 1000 \nEstimation method: Ordinary Least Squares \nSums of Squares and Cross-products: Type I \nEffect sizes (Z) based on F distributions\n\n             Df        SS        MS     Rsq      F        Z Pr(>F)   \nCsize         1 0.0034837 0.0034837 0.14401 2.5410  2.97834  0.001 **\nAncestry      4 0.0082665 0.0020666 0.34173 1.5074  1.49535  0.079 . \nSex           1 0.0018098 0.0018098 0.07481 1.3200  0.70917  0.247   \nAncestry:Sex  1 0.0010333 0.0010333 0.04272 0.7537 -0.43578  0.658   \nResiduals     7 0.0095969 0.0013710 0.39673                          \nTotal        14 0.0241903                                            \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nCall: procD.lm(f1 = Coords ~ Csize + Ancestry * Sex, data = gdf)\n\nplot(d1.pca, main = \"PCA\",\ncol=dat$Sex,\npch=16\n)\n\n\n\n\n\nd1Links <- \"Data/d1Links.csv\"\nd1Links <- read.csv(d1Links)\nsave_data_location <- \"Data/d1Links.rds\"\nsaveRDS(d1Links, file = save_data_location)\n\n\n\n plot(Mshape.Coords, d1Links[ ,2:3])"
  }
]